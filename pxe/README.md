
### **OTUS — Administrator Linux. Professional.**  
#### **Домашнее задание №20 — Настройка PXE-сервера для автоматической установки**

**Цель:**  
Отработать навыки настройки DHCP, TFTP, PXE-загрузчика и автоматической установки ОС по сети.

---

#### **Задание:**
1. Настроить загрузку по сети дистрибутива Ubuntu 24;
2. Обеспечить установку из локального HTTP-репозитория;
3. Настроить автоматическую установку через `user-data`;
4. (*Дополнительно*) Реализовать поддержку UEFI PXE-загрузки.

---

#### **Ход выполнения**

1. **Подготовка стенда:**
   - Используется CentOS 7 (или Ubuntu) как PXE-сервер;
   - Установлены: `dhcp`, `tftp-server`, `xinetd`, `nginx`;
   - Использован Ansible для автоматизации настройки:
     ```
     ansible-playbook pxe_setup.yml
     ```

2. **Настройка TFTP-сервера:**
   - TFTP включён в `xinetd`, директория: `/var/lib/tftpboot`;
   - Добавлен `pxelinux.0`, `ldlinux.c32`, `vesamenu.c32` и другие утилиты из `syslinux`;

3. **Настройка DHCP:**
   - Конфигурация указывает на `pxelinux.0` как файл загрузки:
     ```
     filename "pxelinux.0";
     next-server 192.168.56.10;
     ```

4. **HTTP-сервер:**
   - В `/var/www/html/ubuntu24` размещено содержимое ISO-образа Ubuntu 24;
   - Репозиторий доступен по адресу: `http://192.168.56.10/ubuntu24`;

5. **Конфигурация PXE-загрузки:**
   - Создан `default` в `pxelinux.cfg/`:
     ```
     LABEL ubuntu24
       KERNEL ubuntu24/casper/vmlinuz
       APPEND initrd=ubuntu24/casper/initrd --- autoinstall ds=nocloud-net;s=http://192.168.56.10/autoinstall/
     ```

6. **Автоматическая установка:**
   - В директории `autoinstall/` размещены `user-data` и `meta-data`;
   - В `user-data` настроено:
     - автоматическое разметка;
     - создание пользователя;
     - установка ssh;
     - отключение запроса пароля и прочее.

7. **UEFI-загрузка (** *опционально* **)**:
   - Загружены и настроены `grubnetx64.efi`, `grub.cfg`;
   - DHCP перенастроен под UEFI-клиентов;
   - Проверка выполнена на UEFI-гостевой машине.

---

#### **Вывод**

В результате:
- реализована загрузка Ubuntu 24 по сети через PXE;
- установка производится без участия пользователя (autoinstall);
- репозиторий развёрнут локально через nginx;
- настройка выполнена с помощью Ansible;
- дополнительная поддержка UEFI реализована (по желанию).
