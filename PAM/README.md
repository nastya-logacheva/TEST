### **OTUS — Administrator Linux. Professional.**  
#### **Домашнее задание №15 — Vagrant-стенд с PAM**

**Цель:**  
Научиться создавать пользователей и ограничивать их действия через PAM.

**Критерии приёма:**  
1. Запретить вход пользователям (кроме группы admin) в выходные дни;
2. Назначить конкретному пользователю права на работу с Docker и перезапуск docker-сервиса.

---

#### **Ход выполнения**

1. **Подготовка стенда:**
   - Проект развёрнут через Vagrant и Ansible;
   - Используется дистрибутив CentOS 7;
   - Проверка версии Ansible:
     ```
     $ ansible --version
     ```

2. **Ограничение входа в выходные (через PAM):**
   - Создана группа `admin`;
   - В PAM-файле `/etc/security/time.conf` добавлена строка:
     ```
     login ; * ; !admin ; Wk0000-2400
     ```
     Это запрещает вход всем пользователям, не входящим в группу `admin`, по субботам и воскресеньям.
   - В `/etc/pam.d/sshd` добавлена директива:
     ```
     account required pam_time.so
     ```

3. **Проверка входа:**
   - Пользователь `user1` (не входит в `admin`) получает отказ при попытке входа в выходной день:
     ```
     Access denied
     ```
   - Пользователь `adminuser` входит успешно.

4. **Настройка Docker-доступа:**
   - Установлен Docker:
     ```
     yum install -y docker
     systemctl enable --now docker
     ```
   - Пользователь `dockeradmin` добавлен в группу `docker`:
     ```
     usermod -aG docker dockeradmin
     ```
   - Проверка:
     ```
     su - dockeradmin
     docker ps
     ```

5. **Разрешение перезапуска docker-сервиса через sudo:**
   - Создан файл `/etc/sudoers.d/dockeradmin`:
     ```
     dockeradmin ALL=NOPASSWD: /bin/systemctl restart docker
     ```
   - Проверка:
     ```
     sudo systemctl restart docker
     ```

6. **Автоматизация через Ansible:**
   - Все действия обёрнуты в роли;
   - Проверка выполнялась вручную после `vagrant up`.

---

#### **Вывод**

В результате:
- настроено ограничение входа в выходные дни для всех, кроме `admin`;
- выбранный пользователь получил доступ к Docker и возможность перезапуска службы;
- проект автоматизирован с помощью Ansible;
- отработка проверена вручную и соответствует требованиям.
