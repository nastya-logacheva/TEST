### **OTUS — Administrator Linux. Professional.**  
#### **Домашнее задание №19 — Разворачиваем сетевую лабораторию**

**Цель:**  
Научиться настраивать сетевые интерфейсы и маршрутизацию в Linux, разбивать сеть на подсети и реализовывать сетевую связность.

---

#### **Задание**

**Теоретическая часть:**
1. Найти свободные подсети;
2. Посчитать количество узлов в каждой подсети;
3. Указать broadcast-адрес;
4. Проверить корректность разбиения.

**Практическая часть:**
1. Соединить офисы в сеть согласно схеме;
2. Обеспечить выход в интернет через `inetRouter`;
3. Проверить связность между всеми серверами;
4. Отключить NAT, добавленный Vagrant на интерфейсе `eth0`;
5. При необходимости — добавить интерфейсы.

---

#### **Ход выполнения**

1. **Теоретическое разбиение:**
   - Использовано адресное пространство `192.168.0.0/24`;
   - Разбито на подсети с учётом требований по количеству узлов;
   - Пример:
     - Подсеть 1: `192.168.0.0/28` — 14 узлов, Broadcast: `192.168.0.15`;
     - Подсеть 2: `192.168.0.16/28` — 14 узлов, Broadcast: `192.168.0.31`;
     - ...
   - Проверка выполнена вручную и через калькулятор подсетей.

2. **Развёртывание стенда:**
   - Использован Vagrant;
   - Подняты 5 виртуальных машин: офисы, маршрутизатор и общий сервер;
   - Внесены правки в `Vagrantfile` для добавления дополнительных интерфейсов.

3. **Сетевые настройки:**
   - У каждой машины настроены статические IP;
   - Использованы интерфейсы `eth1`, `eth2`, `eth3` и т.д.;
   - Пример настройки интерфейса:
     ```
     nmcli con mod eth1 ipv4.addresses 192.168.0.5/28
     nmcli con mod eth1 ipv4.method manual
     nmcli con up eth1
     ```

4. **Маршрутизация:**
   - На всех офисных машинах добавлены маршруты через `inetRouter`;
     ```
     ip route add default via 192.168.0.1
     ```
   - В `inetRouter` включена маршрутизация:
     ```
     echo 1 > /proc/sys/net/ipv4/ip_forward
     ```

5. **Отключение дефолтного NAT-интерфейса:**
   - Удалена дефолтная маршрутная запись через `eth0`:
     ```
     ip route del default
     ```

6. **Проверка связности:**
   - Все сервера пингуют друг друга;
   - `traceroute` показывает прохождение через нужные интерфейсы;
   - Интернет-трафик уходит через `inetRouter`.

---

#### **Вывод**

В результате:
- сеть разбита на корректные подсети;
- реализована маршрутизация между всеми офисами;
- настроен централизованный выход в интернет;
- NAT от Vagrant отключён;
- все проверки связности пройдены.
