### **OTUS — Administrator Linux. Professional.**  
#### **Домашнее задание №13 — Практика с SELinux**

**Цель:**  
Научиться работать с SELinux: диагностировать проблемы, модифицировать политики и обеспечивать корректную работу приложений.

**Критерии приёма:**  
1. Запуск nginx на нестандартном порту тремя разными способами:
   - через `setsebool`,
   - добавлением порта в разрешённый тип,
   - созданием собственного модуля SELinux;
2. Обеспечение работы dns-стенда при включённом SELinux.

---

#### **Ход выполнения**

##### Часть 1 — nginx на нестандартном порту

По умолчанию nginx работает на порту 80. Попытка запуска на другом порту при включённом SELinux приводит к ошибке.

1. **Через setsebool + порт 81**
   - Установлен флаг:
     ```
     setsebool -P httpd_can_network_connect 1
     ```
   - Изменён порт в конфиге nginx на 81.
   - nginx успешно запускается.

2. **Добавление порта в тип http_port_t (порт 8080):**
   ```
   semanage port -a -t http_port_t -p tcp 8080
   ```
   - После этого nginx успешно слушает 8080 с включённым SELinux.

3. **Создание и установка модуля SELinux (порт 9090):**
   - Запуск nginx с ошибкой:
     ```
     journalctl -xe | grep nginx
     ```
   - Сбор AVC-логов и генерация модуля:
     ```
     grep nginx /var/log/audit/audit.log | audit2allow -M nginx_custom
     semodule -i nginx_custom.pp
     ```
   - nginx запускается успешно на 9090.

##### Часть 2 — DNS-проект с ошибкой обновления зоны

1. **Развёртывание стенда:**  
   Использован стенд из [репозитория](https://github.com/mbfx/otus-linux-adm/tree/master/selinux_dns_problems).  
   После запуска зона не обновляется.

2. **Анализ проблемы:**
   ```
   journalctl -xe | grep named
   grep named /var/log/audit/audit.log | audit2why
   ```
   - Проблема: SELinux запрещает запись в каталог зоны.

3. **Решение:**  
   Выбрано изменение контекста каталога:
   ```
   semanage fcontext -a -t named_zone_t "/var/named/dynamic(/.*)?"
   restorecon -Rv /var/named/dynamic
   ```
   - После перезапуска named обновление зоны успешно проходит.

---

#### **Вывод**

В ходе выполнения задания:
- nginx запущен на нестандартных портах тремя способами;
- реализована работа dns-зоны при включённом SELinux;
- SELinux-политики модифицированы корректно;
- отработка проверена и задокументирована.
